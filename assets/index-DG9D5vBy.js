import{p as e,a as i,y as je}from"./chunk-C37GKA54-1aOc6qnp.js";import{B as ye,E as Ce,D as R,a as be,u as z,P as fe,b as De,c as L}from"./categoryApi-Ded5M6f5.js";import{u as Se,G as ve,L as Ie}from"./List-BGsElyhc.js";import{u as Pe,k as Te}from"./QueryClientProvider-DAj1Dszq.js";import{u as f}from"./useTranslation-CNdmgvig.js";import{b as x,B as r}from"./index-Caxphnaj.js";import{D as X,A as Fe}from"./Delete-CVYJJiMP.js";import{u as Ee,a as Ae,T as B,I as U,S as N}from"./zod-D6MPtulx.js";import{E as W,v as P}from"./Typography-DyWZUj9a.js";import{o as Le,s as Z,l as Me}from"./types-DmZI4N8b.js";import{D as Y,a as V,b as ee}from"./DialogTitle-Ct1jLhFg.js";import{L as ke,b as we,F as H}from"./profileStore-CksLVF07.js";import{L as C}from"./ListItem-CdM3myKR.js";import{M as b}from"./mutation-BUCJmfyh.js";import"./Modal-CkE2dPQb.js";import"./index-BfSeETMd.js";import"./useThemeProps-WBOW5CEa.js";import"./InputBase-CzclhWl_.js";const Oe=({category:t,onEdit:p,onDelete:s,isDeleting:a=!1})=>{const{t:o}=f("translation",{keyPrefix:"components.category"});return e.jsxs(ye,{variant:"outlined",size:"small","aria-label":o("actionsLabel"),children:[e.jsx(x,{startIcon:e.jsx(Ce,{}),onClick:()=>p(t),"aria-label":`${o("editAriaLabel")} ${t.name}`,children:o("edit")}),e.jsx(x,{startIcon:e.jsx(X,{}),onClick:()=>s(t),disabled:a,color:"error","aria-label":`${o("deleteAriaLabel")} ${t.name}`,children:o(a?"deleting":"delete")})]})},ze=({defaultValues:t,onSubmit:p,isSubmitting:s=!1})=>{var T,u;const{t:a}=f("translation",{keyPrefix:"components.category"}),{t:o}=f("translation",{keyPrefix:"errors.category"}),D=Le({name:Z().min(1,{message:o("invalid_name")}),photo:Z().url({message:o("invalid_photo")}).optional().or(Me(""))}),{register:d,handleSubmit:M,reset:h,formState:{errors:g}}=Ee({resolver:Ae(D),defaultValues:{name:(t==null?void 0:t.name)||"",photo:(t==null?void 0:t.photo)||""}});i.useEffect(()=>{h(t?{name:t.name||"",photo:t.photo||""}:{name:"",photo:""})},[t,h]);const S=m=>{const v={name:m.name,...m.photo&&{photo:m.photo}};p(v)};return e.jsxs(r,{component:"form",onSubmit:M(S),noValidate:!0,sx:{mt:2},children:[e.jsx(B,{...d("name"),label:a("name"),fullWidth:!0,margin:"normal",error:!!g.name,helperText:(T=g.name)==null?void 0:T.message,disabled:s}),e.jsx(B,{...d("photo"),label:a("photo"),fullWidth:!0,margin:"normal",error:!!g.photo,helperText:(u=g.photo)==null?void 0:u.message,disabled:s}),e.jsxs(x,{type:"submit",variant:"contained",fullWidth:!0,sx:{mt:2},disabled:s,children:[s?e.jsx(W,{size:24}):null,a(t?"update":"create")]})]})},Be=({open:t,onClose:p,onSubmit:s,title:a,isSubmitting:o=!1,initialData:D})=>{const{t:d}=f("translation",{keyPrefix:"components.category"});return e.jsxs(Y,{open:t,onClose:p,maxWidth:"sm",fullWidth:!0,children:[e.jsx(V,{children:a}),e.jsx(ee,{children:e.jsx(r,{pt:1,children:e.jsx(ze,{defaultValues:D||void 0,onSubmit:s,isSubmitting:o})})}),e.jsx(R,{children:e.jsx(x,{onClick:p,disabled:o,children:d("cancel")})})]})},We=i.memo(({category:t})=>e.jsx(r,{id:t.id,children:e.jsxs(ke,{children:[e.jsx(C,{children:e.jsx(P,{variant:"h6",children:t.name})}),t.photo&&e.jsx(C,{children:e.jsx(r,{sx:{width:"100%"},children:e.jsx("img",{src:t.photo,alt:t.name,style:{width:"100%",height:"auto"}})})}),e.jsx(C,{children:e.jsxs(P,{variant:"body2",color:"textSecondary",children:["Создано:"," ",new Date(t.createdAt).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})]})}),e.jsx(C,{children:e.jsxs(P,{variant:"body2",color:"textSecondary",children:["Обновлено:"," ",new Date(t.updatedAt).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})]})}),e.jsx(C,{children:e.jsxs(P,{variant:"body2",color:"textSecondary",children:["commandId: ",t.commandId]})}),e.jsx(C,{children:e.jsxs(P,{variant:"body2",color:"textSecondary",children:["ID: ",t.id]})})]})})),J=10,$e=()=>{const{t,i18n:p}=f(),[s,a]=i.useState(1),[o,D]=i.useState("createdAt"),[d,M]=i.useState("DESC"),[h,g]=i.useState(""),[S]=be(h,300),[T,u]=i.useState(!1),[m,v]=i.useState(null),[F,$]=i.useState(null),[te,G]=i.useState(!1),{profile:I}=we(),E=i.useMemo(()=>({pagination:{pageSize:J,pageNumber:s},sorting:{field:o,type:d},...S?{name:S}:{}}),[s,o,d,S]),k=Pe(),{data:j,isLoading:Q,isError:ne,error:A,isFetching:oe}=Se({queryKey:["categories",E,I],queryFn:({signal:n})=>L.list(E,{signal:n}),placeholderData:Te,staleTime:6e4}),_=z({mutationFn:n=>L.create(n),onSuccess:()=>{k.invalidateQueries({queryKey:["categories"]}),w()},onError:n=>{console.error("Ошибка при создании категории:",n)}}),q=z({mutationFn:({id:n,...l})=>L.update(n,l),onSuccess:n=>{k.setQueryData(["categories",E],l=>l&&{...l,data:l.data.map(c=>c.id===n.id?n:c)}),w()},onError:n=>{console.error("Ошибка при обновлении категории:",n)}}),y=z({mutationFn:n=>L.delete(n),onSuccess:(n,l)=>{k.setQueryData(["categories",E],c=>c&&{...c,data:c.data.filter(ue=>ue.id!==l),pagination:{...c.pagination,total:c.pagination.total-1}}),O()},onError:n=>{console.error("Ошибка при удалении категории:",n)}}),ae=(j==null?void 0:j.data)??[],se=(j==null?void 0:j.pagination.total)??0,K=Math.ceil(se/J)||1,re=(n,l)=>{a(l),window.scrollTo({top:0,behavior:"smooth"})},ie=n=>{D(n.target.value),a(1)},le=n=>{M(n.target.value),a(1)},ce=n=>{g(n.target.value),a(1)},de=()=>{g(""),a(1)},me=()=>{v(null),u(!0)},pe=n=>{v(n),u(!0)},w=()=>{u(!1),v(null)},he=n=>{$(n),G(!0)},O=()=>{G(!1),$(null)},ge=()=>{F&&y.mutate(F.id)},xe=n=>{m?q.mutate({...n,id:m.id}):_.mutate(n)};return e.jsxs(r,{width:"100%",children:[e.jsxs(r,{display:"flex",gap:2,mb:2,flexWrap:"wrap",alignItems:"center",children:[e.jsx(B,{label:t("components.category.name"),size:"small",value:h,onChange:ce,placeholder:t("pages.category.title"),slotProps:{input:{endAdornment:h&&e.jsx(r,{component:"span",sx:{cursor:"pointer",px:1},onClick:de,children:"×"})}}}),e.jsxs(H,{size:"small",children:[e.jsx(U,{id:"sort-field-label",children:t("pages.category.title")}),e.jsxs(N,{labelId:"sort-field-label",value:o,label:t("pages.category.title"),onChange:ie,children:[e.jsx(b,{value:"createdAt",children:t("components.category.createdAt")}),e.jsx(b,{value:"updatedAt",children:t("components.category.updatedAt")}),e.jsx(b,{value:"name",children:t("components.category.name")}),e.jsx(b,{value:"id",children:"ID"})]})]}),e.jsxs(H,{size:"small",children:[e.jsx(U,{id:"sort-type-label",children:t("components.category.sortOrder")}),e.jsxs(N,{labelId:"sort-type-label",value:d,label:t("components.category.sortOrder"),onChange:le,children:[e.jsx(b,{value:"ASC",children:t("components.category.ascending")}),e.jsx(b,{value:"DESC",children:t("components.category.descending")})]})]}),I&&I.commandId&&e.jsx(x,{variant:"contained",color:"primary",startIcon:e.jsx(Fe,{}),onClick:me,children:t("components.category.addCategory")})]}),ne?e.jsx(r,{children:A!=null&&A.message?A.message:t("errors.LoadingCategories")}):Q?e.jsx(r,{display:"flex",justifyContent:"center",alignItems:"center",height:200,children:e.jsx(W,{})}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{container:!0,spacing:2,sx:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(min-content, 352px))"},children:e.jsx(Ie,{items:ae,renderItem:n=>e.jsxs(e.Fragment,{children:[e.jsx(We,{category:n},n.id),I&&I.commandId==n.commandId&&e.jsx(r,{sx:{p:2},children:e.jsx(Oe,{category:n,onEdit:pe,onDelete:he,isDeleting:y.variables===n.id&&y.isPending})})]}),itemGridProps:{sx:{xs:12,sm:6,md:4}}})}),K>1&&e.jsx(r,{display:"flex",justifyContent:"center",mt:3,mb:2,children:e.jsx(fe,{count:K,page:s,onChange:re,color:"primary",showFirstButton:!0,showLastButton:!0,siblingCount:1,boundaryCount:1})}),oe&&!Q&&e.jsx(r,{textAlign:"center",mt:1,children:t("components.category.updating")})]}),e.jsx(Be,{open:T,onClose:w,onSubmit:xe,title:t(m?"components.category.editCategory":"components.category.createCategory"),isSubmitting:_.isPending||q.isPending,initialData:m}),e.jsxs(Y,{open:te,onClose:O,children:[e.jsx(V,{children:t("components.category.confirmDelete")}),e.jsx(ee,{children:e.jsx(De,{children:F&&t("components.category.confirmDeleteMessage",{name:F.name})})}),e.jsxs(R,{children:[e.jsx(x,{onClick:O,disabled:y.isPending,children:t("components.category.cancel")}),e.jsx(x,{onClick:ge,color:"error",disabled:y.isPending,startIcon:y.isPending?e.jsx(W,{size:20}):e.jsx(X,{}),children:t("components.category.delete")})]})]})]})},at=()=>{const{t}=f("translation",{keyPrefix:"pages.category"});return[{title:t("title")}]},st=je($e);export{st as default,at as meta};
