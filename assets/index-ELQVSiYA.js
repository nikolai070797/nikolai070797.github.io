import{p as e,a as l,y as fe}from"./chunk-C37GKA54-1aOc6qnp.js";import{B as Ce,E as be,D as U,a as Pe,u as w,P as ye,b as De,c as Se}from"./categoryApi-D2Fwfnkr.js";import{u as N,G as Ie,L as ve}from"./List-BGsElyhc.js";import{u as Ee,k as Ae}from"./QueryClientProvider-DAj1Dszq.js";import{P as Fe,a as Te}from"./PreviewMini-BZAPlVQ5.js";import{u as S}from"./useTranslation-CNdmgvig.js";import{b as d,B as a}from"./index-Caxphnaj.js";import{D as X,A as Me}from"./Delete-CVYJJiMP.js";import{D as Y,a as R,b as ee}from"./DialogTitle-Ct1jLhFg.js";import{E as B}from"./Typography-DyWZUj9a.js";import{p as D}from"./productApi-Wc9uCWn5.js";import{b as ke,F as V}from"./profileStore-CksLVF07.js";import{T as Le,I as Z,S as H}from"./zod-D6MPtulx.js";import{M as h}from"./mutation-BUCJmfyh.js";import"./Modal-CkE2dPQb.js";import"./index-BfSeETMd.js";import"./useThemeProps-WBOW5CEa.js";import"./InputBase-CzclhWl_.js";import"./Close-DzgE1lvC.js";import"./usePreviousProps-DRmkIWSP.js";import"./IconButton-DmZv7dyR.js";import"./types-DmZI4N8b.js";import"./CartItem-Nokkr-Aw.js";import"./ListItem-CdM3myKR.js";import"./Stack-DSn4zSPF.js";const Oe=({product:o,onEdit:x,onDelete:c,isDeleting:r=!1})=>{const{t:s}=S("translation",{keyPrefix:"components.product"});return e.jsxs(Ce,{variant:"outlined",size:"small","aria-label":s("actionsLabel"),children:[e.jsx(d,{startIcon:e.jsx(be,{}),onClick:()=>x(o),"aria-label":`${s("editAriaLabel")} ${o.name}`,children:s("edit")}),e.jsx(d,{startIcon:e.jsx(X,{}),onClick:()=>c(o),disabled:r,color:"error","aria-label":`${s("deleteAriaLabel")} ${o.name}`,children:s(r?"deleting":"delete")})]})},we=({open:o,onClose:x,onSubmit:c,title:r,submitButtonText:s,isSubmitting:u=!1,initialData:g,categories:I,loading:j})=>{const{t:b}=S("translation",{keyPrefix:"components.product"});return e.jsxs(Y,{open:o,onClose:x,maxWidth:"sm",fullWidth:!0,children:[e.jsx(R,{children:r}),e.jsx(ee,{children:e.jsx(a,{pt:1,children:e.jsx(Fe,{categories:I,defaultValues:g||void 0,loading:j,onSubmit:c,isSubmitting:u})})}),e.jsxs(U,{children:[e.jsx(d,{onClick:x,disabled:u,children:b("cancel")}),e.jsx(d,{form:"product-form",type:"submit",variant:"contained",color:"primary",disabled:u,startIcon:u?e.jsx(B,{size:20}):null,children:s})]})]})},J=10,Be=()=>{const{t:o,i18n:x}=S(),[c,r]=l.useState(1),[s,u]=l.useState("createdAt"),[g,I]=l.useState("DESC"),[j,b]=l.useState(""),[v]=Pe(j,300),[te,E]=l.useState(!1),[f,A]=l.useState(null),[P,z]=l.useState(null),[oe,q]=l.useState(!1),{profile:C}=ke(),{data:F,isLoading:T,isError:M}=N({queryKey:["categories"],queryFn:({signal:t})=>Se.list(void 0,{signal:t}),staleTime:300*1e3}),ne=(F==null?void 0:F.data)||[],y=l.useMemo(()=>({pagination:{pageSize:J,pageNumber:c},sorting:{field:s,type:g},...v?{name:v}:{}}),[c,s,g,v]),k=Ee(),{data:p,isLoading:Q,isError:G,error:ze,isFetching:se}=N({queryKey:["products",y,C],queryFn:({signal:t})=>D.list(y,{signal:t}),placeholderData:Ae,staleTime:6e4}),$=w({mutationFn:t=>D.create(t),onSuccess:()=>{k.invalidateQueries({queryKey:["products"]}),L()},onError:t=>{console.error("Ошибка при создании продукта:",t)}}),K=w({mutationFn:({id:t,...n})=>D.update(t,n),onSuccess:t=>{k.setQueryData(["products",y],n=>n&&{...n,data:n.data.map(i=>i.id===t.id?t:i)}),L()},onError:t=>{console.error("Ошибка при обновлении продукта:",t)}}),m=w({mutationFn:t=>D.delete(t),onSuccess:(t,n)=>{k.setQueryData(["products",y],i=>i&&{...i,data:i.data.filter(je=>je.id!==n),pagination:{...i.pagination,total:i.pagination.total-1}}),O()},onError:t=>{console.error("Ошибка при удалении продукта:",t)}}),re=(p==null?void 0:p.data)??[],ae=(p==null?void 0:p.pagination.total)??0,W=Math.ceil(ae/J)||1,ie=(t,n)=>{r(n),window.scrollTo({top:0,behavior:"smooth"})},le=t=>{u(t.target.value),r(1)},ce=t=>{I(t.target.value),r(1)},de=t=>{b(t.target.value),r(1)},ue=()=>{b(""),r(1)},pe=()=>{A(null),E(!0)},me=t=>{A(t),E(!0)},L=()=>{E(!1),A(null)},he=t=>{z(t),q(!0)},O=()=>{q(!1),z(null)},xe=()=>{P&&m.mutate(P.id)},ge=t=>{f?K.mutate({...t,id:f.id}):$.mutate(t)},_=(t,n)=>{n==="edit"?me(t):n==="delete"&&he(t)};return e.jsxs(a,{width:"100%",children:[e.jsxs(a,{display:"flex",gap:2,mb:2,flexWrap:"wrap",alignItems:"center",children:[e.jsx(Le,{label:o("components.product.name"),size:"small",value:j,onChange:de,placeholder:o("pages.product.title"),slotProps:{input:{endAdornment:j&&e.jsx(a,{component:"span",sx:{cursor:"pointer",px:1},onClick:ue,children:"×"})}}}),e.jsxs(V,{size:"small",children:[e.jsx(Z,{id:"sort-field-label",children:o("pages.product.title")}),e.jsxs(H,{labelId:"sort-field-label",value:s,label:o("pages.product.title"),onChange:le,children:[e.jsx(h,{value:"createdAt",children:o("components.product.createdAt")}),e.jsx(h,{value:"updatedAt",children:o("components.product.updatedAt")}),e.jsx(h,{value:"name",children:o("components.product.name")}),e.jsx(h,{value:"id",children:"ID"})]})]}),e.jsxs(V,{size:"small",children:[e.jsx(Z,{id:"sort-type-label",children:o("components.product.sortOrder")}),e.jsxs(H,{labelId:"sort-type-label",value:g,label:o("components.product.sortOrder"),onChange:ce,children:[e.jsx(h,{value:"ASC",children:o("components.product.ascending")}),e.jsx(h,{value:"DESC",children:o("components.product.descending")})]})]}),C&&C.commandId&&e.jsx(d,{variant:"contained",color:"primary",startIcon:e.jsx(Me,{}),onClick:pe,disabled:T||M,children:o("components.product.addProduct")})]}),G||M?e.jsxs(a,{children:[G&&o("errors.LoadingProducts"),M&&o("errors.LoadingCategories")]}):Q||T?e.jsx(a,{display:"flex",justifyContent:"center",alignItems:"center",height:200,children:e.jsx(B,{})}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{container:!0,spacing:2,sx:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(min-content, 352px))"},children:e.jsx(ve,{items:re,renderItem:t=>e.jsxs(a,{sx:{position:"relative"},children:[e.jsx(Te,{product:t}),C&&C.commandId==t.commandId&&e.jsx(a,{sx:{p:2},children:e.jsx(Oe,{product:t,onEdit:()=>_(t,"edit"),onDelete:()=>_(t,"delete"),isDeleting:m.variables===t.id&&m.isPending})})]},t.id)})}),W>1&&e.jsx(a,{display:"flex",justifyContent:"center",mt:3,mb:2,children:e.jsx(ye,{count:W,page:c,onChange:ie,color:"primary",showFirstButton:!0,showLastButton:!0,siblingCount:1,boundaryCount:1})}),se&&!Q&&e.jsx(a,{textAlign:"center",mt:1,children:o("components.product.updating")})]}),e.jsx(we,{open:te,onClose:L,onSubmit:ge,title:o(f?"components.product.editProduct":"components.product.createProduct"),submitButtonText:o(f?"components.product.update":"components.product.create"),isSubmitting:$.isPending||K.isPending,initialData:f,categories:ne,loading:T}),e.jsxs(Y,{open:oe,onClose:O,children:[e.jsx(R,{children:o("components.product.confirmDelete")}),e.jsx(ee,{children:e.jsx(De,{children:P&&o("components.product.confirmDeleteMessage",{name:P.name})})}),e.jsxs(U,{children:[e.jsx(d,{onClick:O,disabled:m.isPending,children:o("components.product.cancel")}),e.jsx(d,{onClick:xe,color:"error",disabled:m.isPending,startIcon:m.isPending?e.jsx(B,{size:20}):e.jsx(X,{}),children:o("components.product.delete")})]})]})]})},ct=()=>{const{t:o}=S("translation",{keyPrefix:"pages.product"});return[{title:o("title")}]},dt=fe(Be);export{dt as default,ct as meta};
